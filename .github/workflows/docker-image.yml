2 / 2

Sure, here's an example of a GitHub Actions workflow file (main.yml) that builds and pushes four microservice container Dockerfiles, where each Dockerfile is located in its own folder:

Copy code
name: Build, Test and Push Microservices

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        microservice: [auth, frontend, ml, safepoint_tracker]
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Build, Test and Push all micro-service
      run: |
        cd ${{ matrix.microservice }}
        docker build -t ${{ matrix.microservice }} .
        if ! docker run --rm ${{ matrix.microservice }} pytest; then exit 1; fi
        docker tag ${{ matrix.microservice }}:latest <your_docker_registry>/${{ matrix.microservice }}:latest
        echo ${{ secrets.DOCKER_USERNAME }}
        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
        docker push <your_docker_registry>/${{ matrix.microservice }}:latest
